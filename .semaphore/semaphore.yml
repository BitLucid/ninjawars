version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Setup
    task:
      jobs:
        - name: Install and Cache
          commands:
            - checkout
            - cache restore
            - yarn install
            - cache store
    dependencies: []
  - name: Test
    task:
      jobs:
        - name: test and build
          commands:
            - checkout
            - cache restore
            - yarn install
            - '# yarn test'
    dependencies:
      - Setup
  - name: PHP test and build
    dependencies:
      - Setup
    task:
      secrets:
        - name: Tchalvak AWS
      env_vars:
        - name: AWS_PROFILE
          value: tchalvak
      jobs:
        - name: PHP
          commands:
            - checkout
            - ./composer.phar install --prefer-dist
            - ./composer.phar test
            - make build
      prologue:
        commands:
          - sem-version php 8.2.2
